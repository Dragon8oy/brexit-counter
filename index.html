<!DOCTYPE html>
<html>
  <head>
    <link rel="shortcut icon" href="assets/icon.png">
    <link rel="stylesheet" href="stylesheet.css">
  </head>
<body>
<h1 id="pageHeading"></h1>
<div style="position: absolute; width: 20%; left: 40%; right: 40%; top: 0%"><h2 id="pageBanner"></h2></div>
<div style="line-height: 3px; font-size: 20px;">
  <p style="display: inline-block;">Today's date: </p> <p id="todayDisplay" style="display: inline-block;" > Sorry, there was an error loading the webpage.</p><br>
  <p style="display: inline-block;" id="eventTitle"></p> <p id="eventDisplay" style="display: inline-block;" > Sorry, there was an error loading the webpage.</p><br>
  <div style="height: 20px"></div>

  <p style="display: inline-block;">Weeks ago: </p> <p id="weeksAgoHtml" style="display: inline-block;"> Loading...</p><br>
  <p style="display: inline-block;">Days ago: </p> <p id="daysAgoHtml" style="display: inline-block;"> Loading...</p><br>
  <p style="display: inline-block;">Hours ago: </p> <p id="hoursAgoHtml" style="display: inline-block;"> Loading...</p><br>
</div>

<div style="position: fixed; top: 5px; right: 5px;">
  <h3 style="display: inline-block; vertical-align: middle;">Dark theme: </h3>
  <label class="switch" style="display: inline-block; vertical-align: middle;">
    <input type="checkbox" id="slider" onclick="toggleThemeSlider()">
    <span class="slider round"></span>
  </label>
</div>

<div class="spriteContainer">
  <div class="spriteQuote" id=spriteOneQuote>
    <img style="width: 100%; height: auto; min-width: 1px;" src="assets/quote.png">
    <p class="spriteQuoteText" id=spriteOneQuoteText></p>
  </div>
  <div class="spriteQuote" id=spriteTwoQuote>
    <img style="width: 100%; height: auto; min-width: 1px;" src="assets/quote.png">
    <p class="spriteQuoteText" id=spriteTwoQuoteText></p>
  </div>
  <div class="spriteQuote" id=spriteThreeQuote>
    <img style="width: 100%; height: auto; min-width: 1px;" src="assets/quote.png">
    <p class="spriteQuoteText" id=spriteThreeQuoteText></p>
  </div>
  <img class="sprites" id=spriteOne src="assets/spriteOne.png">
  <img class="sprites" id=spriteTwo src="assets/spriteTwo.png">
  <img class="sprites" id=spriteThree src="assets/spriteThree.png">
</div>

<script src=settings.js>//Page settings</script>
<script src=dateCalc.js>//Date calculations</script>
<script> //Load page graphics
document.title = pageSettings.title;
document.getElementById('pageBanner').innerHTML = pageSettings.bannerText;
document.getElementById('pageHeading').innerHTML = pageSettings.pageHeading;
document.getElementById('eventTitle').innerHTML = pageSettings.eventTitle;

setSlider()
toggleTheme()
function readSavedTheme() {
  theme = window.localStorage['theme'];
  if (theme == undefined) {
    window.localStorage['theme'] = 'dark';
    theme = 'dark'
  }
  return theme
}

function setSlider() {
  theme = readSavedTheme()
  if (theme == 'dark') {
    document.getElementById('slider').checked = true;
  } else {
    document.getElementById('slider').checked = false;
  }
}

function toggleThemeSlider() {
  theme = readSavedTheme()
  if (theme == 'dark') {
    window.localStorage['theme'] = 'light';
  } else {
    window.localStorage['theme'] = 'dark';
  }
  toggleTheme()
}

function toggleTheme() {
  theme = readSavedTheme();
  if (theme == 'dark') { //Set theme to dark
    document.body.style.backgroundColor = '#38373a';
    document.body.style.color = 'white';
  } else { //Set theme to light
    document.body.style.backgroundColor = 'white';
    document.body.style.color = 'black';
  }
}
</script>
<script> //Calculate time from / to date
today = new Date();
document.getElementById("eventDisplay").innerHTML = pageSettings.eventDateString.getDate() + '/' + pageSettings.eventDateString.getMonth() + 1 + '/' + pageSettings.eventDateString.getFullYear();
document.getElementById("todayDisplay").innerHTML = today.getDate() + '/' + today.getMonth() + '/' + today.getFullYear();

setTimeout(update, 1000);
function update() {
  document.getElementById("todayDisplay").innerHTML = today.getDate() + '/' + today.getMonth() + '/' + today.getFullYear();
  calculateTime()
  displayTime()
  setTimeout(update, 1000);
}
</script>
<script> //Animate the sprites
animateSprite('spriteOne', 'reverse')
animateSprite('spriteTwo', 'reverse')
animateSprite('spriteThree', 'reverse')
setTimeout(selectSprite, 1000);
function selectSprite() {
  chooseSprite = Math.floor((Math.random() * 3) + 1);
  if (chooseSprite == '1') {
    if (spriteOneUp == '1') {
      animateSprite('spriteOne', 'reverse')
    } else if (spriteOneUp = '0') {
      if (runOneAgain == '0') {
        showQuote('spriteOne')
        animateSprite('spriteOne', 'normal')
      }
    }
    runOneAgain = 0
  } else if (chooseSprite == '2') {
    if (spriteTwoUp == '1') {
      animateSprite('spriteTwo', 'reverse')
    } else if (spriteTwoUp = '0') {
      if (runTwoAgain == '0') {
        showQuote('spriteTwo')
        animateSprite('spriteTwo', 'normal')
      }
    }
    runTwoAgain = 0
  } else if (chooseSprite == '3') {
    if (spriteThreeUp == '1') {
      animateSprite('spriteThree', 'reverse')
    } else if (spriteThreeUp = '0') {
      if (runThreeAgain == '0') {
        showQuote('spriteThree')
        animateSprite('spriteThree', 'normal')
      }
    }
    runThreeAgain = 0
  }
  setTimeout(selectSprite, 3500);
}

function showQuote(targetSprite) {
  var file = new XMLHttpRequest();
  file.open("GET", pageSettings.quoteFileLocation, true);
  file.onreadystatechange = function() {
    if (file.readyState === 4) {
      if (file.status === 200) {
        text = file.responseText;
        quotes = text.split("| ")
        document.getElementById(targetSprite + 'Quote').classList.toggle('fade');
        document.getElementById(targetSprite + 'QuoteText').textContent = quotes[Math.floor(Math.random() * quotes.length)];
        setTimeout(function () {document.getElementById(targetSprite + 'Quote').classList.toggle('fade')}, pageSettings.quoteTimer)
      }
    }
  }
  file.send(null);
}

function animateSprite(targetSprite, direction) {
    document.getElementById(targetSprite).animate([
    { transform: 'translateY(500px)' }, //Start (Pixels off screen)
    { transform: 'translateY(50px)' } //End
  ], { 
    duration: 2000,
    fill: 'forwards',
    direction: direction,
    iterations: 1
  });
  if (direction == 'normal') {
    if (targetSprite == 'spriteOne') {spriteOneUp = '1';};
    if (targetSprite == 'spriteTwo') {spriteTwoUp = '1';};
    if (targetSprite == 'spriteThree') {spriteThreeUp = '1';};
  } else {
    if (targetSprite == 'spriteOne') {
      spriteOneUp = '0';
      runOneAgain = '1';
    };
    if (targetSprite == 'spriteTwo') {
      spriteTwoUp = '0';
      runTwoAgain = '1';
    };
    if (targetSprite == 'spriteThree') {
      spriteThreeUp = '0';
      runThreeAgain = '1';
    };
  }
}
</script>
</body>
</html>

