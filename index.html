<!DOCTYPE html>
<html>
<title>Brexit Countdown</title>
<head>
  <link rel="shortcut icon" href="flag.png">
  <link rel="stylesheet" href="stylesheet.css">
</head>
<body>
<h1>Brexit Countdown</h1>
<div style="line-height: 3px; font-size: 20px;">
  <p style="display: inline-block;">Today's date: </p> <p id="today_display" style="display: inline-block;" > Sorry, there was an error loading the webpage.</p><br>
  <p style="display: inline-block;">Brexit date: </p> <p id="brexit_display" style="display: inline-block;" > Sorry, there was an error loading the webpage.</p><br>
  <div style="height: 20px"></div>

  <p style="display: inline-block;">Weeks left: </p> <p id="weeks_left_html" style="display: inline-block;"> Loading...</p><br>
  <p style="display: inline-block;">Days left: </p> <p id="days_left_html" style="display: inline-block;"> Loading...</p><br>
  <p style="display: inline-block;">Hours left: </p> <p id="hours_left_html" style="display: inline-block;"> Loading...</p><br>
</div>

<div style="position: fixed; top: 5px; right: 5px;">
  <h3 style="display: inline-block; vertical-align: middle;">Dark theme: </h3>
  <label class="switch" style="display: inline-block; vertical-align: middle;">
    <input type="checkbox" id="slider" onclick="toggleThemeSlider()">
    <span class="slider round"></span>
  </label>
</div>

<div class="headContainer">
<div class="headQuote" id=headOneQuote>
  <img src="quote.png">
  <p class="headQuoteText" id=headOneQuoteText>I'm Theresa</p>
</div>
<div class="headQuote" id=headTwoQuote>
  <img src="quote.png">
  <p class="headQuoteText" id=headTwoQuoteText>I'm Boris</p>
</div>
<div class="headQuote" id=headThreeQuote>
  <img src="quote.png">
  <p class="headQuoteText" id=headThreeQuoteText>I'm Nigel</p>
</div>
  <img class="heads" id=headOne src="theresa.png">
  <img class="heads" id=headTwo src="boris.png">
  <img class="heads" id=headThree src="nigel.png">
</div>

<script>
setSlider()
toggleTheme()
function readSavedTheme() {
  var theme = window.localStorage['theme'];
  if (theme == undefined) {
    window.localStorage['theme'] = 'dark';
    theme = 'dark'
  }
  return theme
}

function setSlider() {
  var theme = readSavedTheme()
  if (theme == 'dark') {
    document.getElementById('slider').checked = true;
  } else {
    document.getElementById('slider').checked = false;
  }
}

function toggleThemeSlider() {
  var theme = readSavedTheme()
  if (theme == 'dark') {
    window.localStorage['theme'] = 'light';
  } else {
    window.localStorage['theme'] = 'dark';
  }
  toggleTheme()
}

function toggleTheme() {
  var theme = readSavedTheme();
  if (theme == 'dark') {
    //Set theme to dark
    document.body.style.backgroundColor = '#38373a';
    document.body.style.color = 'white';
  } else {
    //Set theme to light
    document.body.style.backgroundColor = 'white';
    document.body.style.color = 'black';
  }
}

</script>
<script>
var today = new Date();
var brexit_string = new Date(2020, 0, 30, 12); //Year, Month, Day, Hour
//var brexit_string = new Date(today.getFullYear(), 1, 30, 12); //Month, Day, Hour
var brexit_fixed = '31/01/20'
var dd = today.getDate();
var mm = today.getMonth()+1;
var yy = today.getYear()-100;
if(dd<10) {
    dd = '0'+dd
} 
if(mm<10) {
    mm = '0'+mm
}
if(yy<10) {
    yy = '0'+yy
}
today = dd + '/' + mm + '/' + yy;
document.getElementById("today_display").innerHTML = today;
document.getElementById("brexit_display").innerHTML = brexit_fixed;

today_array = today.replace('/', '').replace('/', '').split("")
brexit_array = brexit_fixed.replace('/', '').replace('/', '').split("")

checkDate()
function checkDate() {
  for (i = 2; i < 6; i++) {
    if (today_array[i] < brexit_array[i]) {
      return
    }
  }
  for (i = 0; i < 2; i++) {
    if (today_array[i] < brexit_array[i]) {
      return
    }
    if (i == 1) {
      window.alert('Britain actually left the EU...');
    }
  }
}

var today = new Date();

setTimeout(update, 1000);
function update() {
  calculate_time()
  display_time()
  setTimeout(update, 1000);
}

var hours_left
var days_left
var weeks_left

function calculate_time() {
  var today = new Date();
  var one_hour = 1000*60*60;
  var one_day = 1000*60*60*24;
  var one_week = 1000*60*60*24*7;
  weeks_left = Math.floor((brexit_string.getTime()-today.getTime())/(one_week));
  days_left = Math.ceil((brexit_string.getTime()-today.getTime())/(one_day)-((weeks_left) * 7));
  hours_left = Math.ceil((brexit_string.getTime()-today.getTime())/(one_hour)-(((days_left - 1) + (weeks_left * 7)) * 24));
}

function display_time() {
  document.getElementById("hours_left_html").innerHTML = hours_left;
  document.getElementById("days_left_html").innerHTML = days_left;
  document.getElementById("weeks_left_html").innerHTML = weeks_left;
}
</script>
<script>
animateHead('headOne', 'reverse')
animateHead('headTwo', 'reverse')
animateHead('headThree', 'reverse')
var headOneUp
var headTwoUp
var headThreeUp
var runOneAgain
var runTwoAgain
var runThreeAgain
setTimeout(peak, 1000);
function peak() {
  var chooseHead = Math.floor((Math.random() * 3) + 1);
  if (chooseHead == '1') {
    if (headOneUp == '1') {
      animateHead('headOne', 'reverse')
    }
    if (headOneUp = '0') {
      if (runOneAgain == '0') {
        showQuote('headOne')
        animateHead('headOne', 'normal')
      }
    }
    runOneAgain = 0
  }
  if (chooseHead == '2') {
    if (headTwoUp == '1') {
      animateHead('headTwo', 'reverse')
    }
    if (headTwoUp = '0') {
      if (runTwoAgain == '0') {
        showQuote('headTwo')
        animateHead('headTwo', 'normal')
      }
    }
    runTwoAgain = 0
  }
  if (chooseHead == '3') {
    if (headThreeUp == '1') {
      animateHead('headThree', 'reverse')
    }
    if (headThreeUp = '0') {
      if (runThreeAgain == '0') {
        showQuote('headThree')
        animateHead('headThree', 'normal')
      }
    }
    runThreeAgain = 0
  }
  setTimeout(peak, 3500);
}

function showQuote(targetHead) {
  var file = new XMLHttpRequest();
  file.open("GET", "https://raw.githubusercontent.com/Dragon8oy/brexit-counter/master/quotes.txt", true);
  file.onreadystatechange = function() {
    if (file.readyState === 4) {
      if (file.status === 200) {
        text = file.responseText;
        quotes = text.split("| ")
        document.getElementById(targetHead + 'Quote').classList.toggle('fade');
        document.getElementById(targetHead + 'QuoteText').textContent = quotes[Math.floor(Math.random() * quotes.length)];
        setTimeout(function () {document.getElementById(targetHead + 'Quote').classList.toggle('fade')}, 5000)
      }
    }
  }
  file.send(null);
}

function animateHead(targetHead, direction) {
    document.getElementById(targetHead).animate([
    // keyframes
    { transform: 'translateY(500px)' }, //From here (Negatives)
    { transform: 'translateY(50px)' } //To here (- Means positive)
  ], { 
    // timing options
    duration: 2000,
    fill: 'forwards',
    direction: direction,
    iterations: 1
  });
  if (direction == 'normal') {
    if (targetHead == 'headOne') {headOneUp = '1';};
    if (targetHead == 'headTwo') {headTwoUp = '1';};
    if (targetHead == 'headThree') {headThreeUp = '1';};
  } else {
    if (targetHead == 'headOne') {
      headOneUp = '0';
      runOneAgain = '1';
    };
    if (targetHead == 'headTwo') {
      headTwoUp = '0';
      runTwoAgain = '1';
    };
    if (targetHead == 'headThree') {
      headThreeUp = '0';
      runThreeAgain = '1';
    };
  }
}
</script>
</body>
</html>

